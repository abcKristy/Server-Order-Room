# Reservation System

Spring Boot приложение для управления бронированием комнат с PostgreSQL базой данных.

## О проекте

Система бронирования комнат предоставляет REST API для управления бронированиями, проверки доступности комнат и обработки статусов бронирований.

## Технологии

- **Java 17+**
- **Spring Boot 3.5.6**
- **Spring Data JPA**
- **Maven**
- **Spring Web**
- **PostgreSQL 18**


## Модель данных

### ReservationEntity
- `id` - идентификатор бронирования
- `client_id` - идентификатор клиента
- `room_id` - идентификатор комнаты
- `start_date` - дата начала бронирования
- `end_date` - дата окончания бронирования
- `status` - статус бронирования (PENDING, APPROVED, CANCELED)

### Reservation (DTO)
- `id` - идентификатор бронирования (только для чтения, генерируется автоматически)
- `userId` - идентификатор пользователя (обязательное поле)
- `roomId` - идентификатор комнаты (обязательное поле)
- `startDate` - дата начала бронирования (обязательное поле, текущая или будущая дата)
- `endDate` - дата окончания бронирования (обязательное поле, текущая или будущая дата)
- `status` - статус бронирования (PENDING, APPROVED, CANCELED)

### CheckAvailabilityRequest
- `roomId` - идентификатор комнаты для проверки (обязательное поле)
- `startDate` - желаемая дата начала бронирования (обязательное поле)
- `endDate` - желаемая дата окончания бронирования (обязательное поле)

### ReservationEntity
- `id` - идентификатор бронирования (Primary Key)
- `client_id` - идентификатор клиента
- `room_id` - идентификатор комнаты
- `start_date` - дата начала бронирования
- `end_date` - дата окончания бронирования
- `status` - статус бронирования (PENDING, APPROVED, CANCELED)

## Сервисы и Контроллеры

### ReservationAvailabilityService
**Назначение:** Проверка доступности комнат для бронирования

**Основные методы:**
- `isReservationAvailable()` - проверяет доступность комнаты в указанные даты
- Валидирует корректность дат (начальная дата должна быть раньше конечной)
- Ищет конфликтующие APPROVED бронирования через репозиторий
- Логирует конфликтующие ID бронирований

### ReservationAvailabilityController
**Endpoint:** `POST /reservation/availability/check`

**Функциональность:**
- Принимает запрос на проверку доступности комнаты
- Возвращает статус AVAILABLE или RESERVED
- Логирует входящие запросы

### ReservationService
**Назначение:** Бизнес-логика управления бронированиями

**Основные методы:**
- `getReservationById()` - поиск бронирования по ID
- `searchAllByFilter()` - поиск с фильтрацией и пагинацией
- `createReservation()` - создание нового бронирования (автоматически PENDING)
- `updateReservation()` - обновление бронирования (только для PENDING статуса)
- `cancelReservation()` - отмена бронирования (ограничения для APPROVED)
- `approveReservation()` - подтверждение бронирования с проверкой доступности

**Бизнес-правила:**
- Новые бронирования создаются только со статусом PENDING
- Обновление возможно только для PENDING бронирований
- Отмена APPROVED бронирований требует менеджера
- Подтверждение требует проверки доступности комнаты

### ReservationController
**Endpoints:**
- `GET /reservation/{id}` - получение бронирования по ID
- `GET /reservation` - поиск всех бронирований с фильтрацией
- `POST /reservation` - создание нового бронирования
- `PUT /reservation/{id}` - обновление бронирования
- `DELETE /reservation/{id}/cancel` - отмена бронирования
- `POST /reservation/{id}/approve` - подтверждение бронирования

**Особенности:**
- Валидация входящих данных
- Логирование всех операций
- Пагинация и фильтрация для поиска
- Соответствие HTTP статусов бизнес-логике

## Обработка ошибок

### ErrorResponseDto
**Структура ответа об ошибке:**
- `message` - общее описание ошибки
- `detailedMassage` - детальное сообщение об ошибке
- `errortime` - временная метка возникновения ошибки

### GlobalExceptionHandler
**Централизованный обработчик исключений для всего приложения**

#### Обрабатываемые исключения:

**404 Not Found**
- `EntityNotFoundException` - сущность не найдена в базе данных
- **Пример:** "Not found reservation by id = 999"

**400 Bad Request**
- `IllegalArgumentException` - некорректные аргументы
- `IllegalStateException` - некорректное состояние операции
- `MethodArgumentNotValidException` - ошибки валидации входных данных
- **Примеры:**
    - "start should to be before end"
    - "Status should be empty"
    - "cannot modify reservation status APPROVED"

**500 Internal Server Error**
- `Exception` - все остальные непредвиденные ошибки

#### Особенности обработки:
- Логирование всех исключений с полным stack trace
- Единый формат ответа для всех ошибок
- Соответствие HTTP статусов типу исключения
- Временная метка для отслеживания времени ошибки

## Настройка и запуск

### Предварительные требования
- Java 17 или выше
- PostgreSQL 12 или выше
- Maven 3.6 или выше
